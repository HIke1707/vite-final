import{e as f,l as N,o as i,a as r,b as t,F as $,r as P,t as p,p as d,B as C,d as V,v}from"./index-3to8NFAF.js";import{a as b}from"./axios-G2rPRu76.js";const B={class:"container"},F=t("div",{class:"col-md-8"},[t("h2",{class:"w50"},"優惠券維護列表")],-1),J={class:"row"},O={class:"col-md-12"},T={class:"table table-hover mt-4"},E=t("thead",null,[t("tr",null,[t("th",null,"優惠券編號"),t("th",null,"到期時間"),t("th",null,"優惠券標題"),t("th",null,"優惠券代碼"),t("th",null,"折價"),t("th",null,"狀態")])],-1),H={key:0},Y=["onUpdate:modelValue","onChange"],j=t("option",{value:"0"},"停用",-1),q=t("option",{value:"1"},"啟用",-1),z=[j,q],A=["onClick"],G={key:1},I=t("td",null,null,-1),K=["onUpdate:modelValue"],Q=["onUpdate:modelValue"],R=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Z=t("option",{value:"0"},"停用",-1),tt=t("option",{value:"1"},"啟用",-1),et=[Z,tt],lt={__name:"CouponManagement",setup(st){class m{constructor(s){this.title=(s==null?void 0:s.title)??"",this.is_enabled=(s==null?void 0:s.is_enabled)??0,this.percent=(s==null?void 0:s.percent)??1e3,this.discount=(s==null?void 0:s.discount)??0,this.due_date=(s==null?void 0:s.due_date)??0,this.code=(s==null?void 0:s.code)??""}}const _="https://ec-course-api.hexschool.io/v2",h="yangapi",u=f([]),U=f({}),g=async(a=1)=>{const s=`${_}/api/${h}/admin/coupons?page=${a}`;await b.get(s).then(e=>{u.value=e.data.coupons.map(n=>({...n,status:"stay"})),U.value=e.data.pagination}).catch(e=>{console.debug(e)})},k=()=>{u.value.push({...new m,status:"new"})},x=async()=>{const a=u.value.filter(o=>o.status==="edited"),s=u.value.filter(o=>o.status==="new"),e=u.value.filter(o=>o.status==="remove"),n=[],l=a.map(async o=>{await D(o)||n.push(o)}),c=s.map(async o=>{await M(o)||n.push(o)}),y=e.map(async o=>{await S(o)||n.push(o)});await Promise.all([...l,...c,...y]),n.length>0?alert("操作失敗，請檢查優惠卷資訊"):(alert("儲存成功"),g())},D=async a=>{const s=`${_}/api/${h}/admin/coupon/${a.id}`;let e=!1;const n={data:new m(a)};return await b.put(s,n).then(l=>{const{success:c}=l.data;e=c}).catch(l=>{alert(JSON.stringify(l))}),e},M=async a=>{const s=`${_}/api/${h}/admin/coupon`;let e=!1;const n={data:new m(a)};return n.data.due_date=new Date(n.data.due_date).getTime(),await b.post(s,n).then(l=>{const{success:c}=l.data;e=c}).catch(l=>{alert(JSON.stringify(l))}),e},S=async a=>{const s=a.id,e=`${_}/api/${h}/admin/coupon/${s}`;let n=!1;return await b.delete(e).then(l=>{const{success:c}=l.data;n=c}).catch(l=>{alert(JSON.stringify(l))}),n},L=a=>{const s=new Date(a),e=s.getFullYear(),n=("0"+(s.getMonth()+1)).slice(-2),l=("0"+s.getDate()).slice(-2),c=("0"+s.getHours()).slice(-2),y=("0"+s.getMinutes()).slice(-2),o=("0"+s.getSeconds()).slice(-2);return`${e}-${n}-${l} ${c}:${y}:${o}`};return N(()=>{g()}),(a,s)=>(i(),r("div",B,[t("div",{class:"row"},[F,t("div",{class:"col-md-4"},[t("button",{type:"button",class:"btn btn-primary",onClick:x}," 儲存 ")])]),t("div",J,[t("div",O,[t("table",T,[E,t("tbody",null,[(i(!0),r($,null,P(u.value,e=>(i(),r($,{key:e.id},[e.status=="stay"||e.status=="edited"?(i(),r("tr",H,[t("td",null,p(e.id),1),t("td",null,p(L(e.due_date)),1),t("td",null,p(e.title),1),t("td",null,p(e.code),1),t("td",null,p(e.discount),1),t("td",null,[d(t("select",{class:"form-select","aria-label":"Disabled select example","onUpdate:modelValue":n=>e.is_enabled=n,onChange:n=>e.status="edited"},z,40,Y),[[C,e.is_enabled,void 0,{number:!0}]])]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:n=>e.status="remove"}," 移除 ",8,A)])])):V("",!0),e.status=="new"?(i(),r("tr",G,[I,t("td",null,[d(t("input",{type:"date","onUpdate:modelValue":n=>e.due_date=n},null,8,K),[[v,e.due_date]])]),t("td",null,[d(t("input",{type:"text","onUpdate:modelValue":n=>e.title=n},null,8,Q),[[v,e.title]])]),t("td",null,[d(t("input",{type:"text","onUpdate:modelValue":n=>e.code=n},null,8,R),[[v,e.code]])]),t("td",null,[d(t("input",{type:"number","onUpdate:modelValue":n=>e.discount=n},null,8,W),[[v,e.discount]])]),t("td",null,[d(t("select",{class:"form-select","aria-label":"Disabled select example","onUpdate:modelValue":n=>e.is_enabled=n},et,8,X),[[C,e.is_enabled,void 0,{number:!0}]])])])):V("",!0)],64))),128))])])])]),t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("button",{type:"button",class:"btn btn-primary",onClick:k}," 新增 ")])])]))}};export{lt as default};
