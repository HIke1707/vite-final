import{a as E}from"./axios-G2rPRu76.js";import{_ as T,k as b,q as z,o as L,b as c,c as i,d as t,g as I,t as n,j as A,p as G,F as B,h as Y,s as K,u as Q,e as R}from"./index-ZyHefE6V.js";import{M as j}from"./modal-8GjLtis6.js";const r=v=>(K("data-v-d5c51b18"),v=v(),Q(),v),W={id:"orderDetailModal",ref:"orderDetailModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderDetailModalLabel","aria-hidden":"true"},X={class:"modal-dialog modal-xl"},Z={class:"modal-content border-0"},tt=r(()=>t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"orderDetailModalLabel",class:"modal-title"},[t("span",null,"訂單資訊")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),et={class:"modal-body"},st={class:"row"},lt={class:"col-md-12"},ot={class:"table table-bordered"},at={class:"t-title",colspan:"4"},nt=r(()=>t("td",{class:"t-title"},"訂單編號",-1)),dt=r(()=>t("td",{class:"t-title"},"訂單時間",-1)),ct=r(()=>t("td",{class:"t-title"},"總價格",-1)),it=r(()=>t("td",{class:"t-title"},"付款狀態",-1)),rt={key:0},ut={key:1},pt={key:0,type:"button",class:"btn btn-success btn-sm"},_t={key:1,type:"button",class:"btn btn-secondary btn-sm"},ht=r(()=>t("td",{class:"t-title"},"用戶",-1)),bt=r(()=>t("td",{class:"t-title"},"電話號碼",-1)),vt=r(()=>t("td",{class:"t-title"},"地址",-1)),mt=r(()=>t("td",{class:"t-title"},"email",-1)),yt={class:"row"},$t=r(()=>t("div",{class:"col-md-12"},[t("span",null,"商品明細")],-1)),gt={class:"col-md-12"},ft={class:"table"},Mt=r(()=>t("thead",null,[t("tr",null,[t("th",null,"商品名稱"),t("th",null,"數量"),t("th",null,"價格")])],-1)),kt={class:"modal-footer"},xt={__name:"OrderDetail",props:{propitem:null},emits:["close"],setup(v,{expose:x,emit:w}){const M="https://ec-course-api.hexschool.io/v2",O="yangapi",C=v,m=w,u=b(null),l=z(()=>C.propitem),p=b(!1),g=b(!1),f=()=>{u.value.show()},_=()=>{u.value.hide(),g.value&&m("close")},d=s=>{const e=new Date(s),y=e.getFullYear(),h=("0"+(e.getMonth()+1)).slice(-2),$=("0"+e.getDate()).slice(-2),k=("0"+e.getHours()).slice(-2),D=("0"+e.getMinutes()).slice(-2),S=("0"+e.getSeconds()).slice(-2);return`${y}-${h}-${$} ${k}:${D}:${S}`},o=async()=>{const s=`${M}/api/${O}/admin/order/${l.value.id}`;let e=!1;const y={data:l.value};return await E.put(s,y).then(h=>{const{success:$}=h.data;e=$,g.value=!0,alert("訂單更新成功！"),p.value=!1}).catch(h=>{alert(JSON.stringify(h))}),e};return L(async()=>{u.value=new j(document.getElementById("orderDetailModal"),{keyboard:!1})}),x({openModal:f,hideModal:_}),(s,e)=>{var y,h,$,k,D,S,N,F,U,V,P,q;return c(),i("div",W,[t("div",X,[t("div",Z,[tt,t("div",et,[t("div",st,[t("div",lt,[t("table",ot,[t("thead",null,[t("tr",null,[t("th",at,[I(" 訂單資訊 "),p.value?(c(),i("button",{key:1,type:"button",class:"btn btn-primary",style:{float:"right"},onClick:o}," 儲存 ")):(c(),i("button",{key:0,type:"button",class:"btn btn-primary",style:{float:"right"},onClick:e[0]||(e[0]=a=>p.value=!0)}," 編輯 "))])])]),t("tbody",null,[t("tr",null,[nt,t("td",null,n((y=l.value)==null?void 0:y.id),1),dt,t("td",null,n(d((h=l.value)==null?void 0:h.create_at)),1)]),t("tr",null,[ct,t("td",null,n(($=l.value)==null?void 0:$.total),1),it,p.value?(c(),i("td",rt,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.is_paid=a)},null,512),[[G,l.value.is_paid]]),I("已付款 ")])):(c(),i("td",ut,[l.value.is_paid?(c(),i("button",pt,"已付款")):(c(),i("button",_t,"未付款"))]))]),t("tr",null,[ht,t("td",null,n((D=(k=l.value)==null?void 0:k.user)==null?void 0:D.name),1),bt,t("td",null,n((N=(S=l.value)==null?void 0:S.user)==null?void 0:N.tel),1)]),t("tr",null,[vt,t("td",null,n((U=(F=l.value)==null?void 0:F.user)==null?void 0:U.address),1),mt,t("td",null,n((P=(V=l.value)==null?void 0:V.user)==null?void 0:P.email),1)])])])])]),t("div",yt,[$t,t("div",gt,[t("table",ft,[Mt,t("tbody",null,[(c(!0),i(B,null,Y((q=l.value)==null?void 0:q.products,a=>{var H,J;return c(),i("tr",{key:a.id},[t("td",null,n((H=a==null?void 0:a.product)==null?void 0:H.title),1),t("td",null,n(a==null?void 0:a.qty),1),t("td",null,n((J=a==null?void 0:a.product)==null?void 0:J.price),1)])}),128))])])])])]),t("div",kt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=a=>_())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=a=>_())}," 確認 ")])])])],512)}}},wt=T(xt,[["__scopeId","data-v-d5c51b18"]]),Ot={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ct={class:"modal-dialog"},Dt={class:"modal-content border-0"},St=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delOrderModalLabel",class:"modal-title"},[t("span",null,"刪除訂單")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),It={class:"modal-body"},Bt=t("strong",{class:"text-danger"},null,-1),Et={class:"modal-footer"},Lt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Nt={__name:"DeleteOrderModal",props:{propitem:null},emits:["close"],setup(v,{expose:x,emit:w}){const M="https://ec-course-api.hexschool.io/v2",O="yangapi",C=v,m=w,u=b(null),l=()=>{u.value.show()},p=()=>{u.value.hide()},g=async()=>{const f=C.propitem.id,_=`${M}/api/${O}/admin/order/${f}`;let d=!1;return await E.delete(_).then(o=>{const{success:s}=o.data;d=s,alert("已刪除訂單"),p(),m("close")}).catch(o=>{alert(JSON.stringify(o))}),d};return L(async()=>{u.value=new j(document.getElementById("delOrderModal"),{keyboard:!1})}),x({openModal:l,hideModal:p}),(f,_)=>(c(),i("div",Ot,[t("div",Ct,[t("div",Dt,[St,t("div",It,[I(" 是否刪除 "),Bt,I(" 訂單"+n(v.propitem.id)+"(刪除後將無法恢復)。 ",1)]),t("div",Et,[Lt,t("button",{type:"button",class:"btn btn-danger",onClick:_[0]||(_[0]=d=>g())}," 確認刪除 ")])])])],512))}},Ft={class:"container"},Ut=t("div",{class:"row"},[t("div",{class:"col-md-8"},[t("h2",{class:"w50"},"訂單維護列表")])],-1),Vt={class:"table table-hover mt-4"},Pt=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"成立時間"),t("th",null,"用戶"),t("th",null,"付款狀態"),t("th",null,"詳細資訊"),t("th",null,"刪除訂單")])],-1),qt=["onClick"],Ht=["onClick"],jt={__name:"OrderManagement",setup(v){const x="https://ec-course-api.hexschool.io/v2",w="yangapi",M=b([]),O=b({}),C=b(!1),m=b({}),u=b(null),l=b(null),p=async(d=1)=>{const o=`${x}/api/${w}/admin/orders?page=${d}`;await E.get(o).then(s=>{M.value=s.data.orders,O.value=s.data.pagination}).catch(s=>{console.debug(s)})},g=(d,o)=>{d==="detail"?(m.value={...o},l.value.openModal()):d==="edit"?(m.value={...o},C.value=!0,l.value.openModal()):d==="delete"&&(m.value=o,u.value.openModal())},f=()=>{p()},_=d=>{const o=new Date(d),s=o.getFullYear(),e=("0"+(o.getMonth()+1)).slice(-2),y=("0"+o.getDate()).slice(-2),h=("0"+o.getHours()).slice(-2),$=("0"+o.getMinutes()).slice(-2),k=("0"+o.getSeconds()).slice(-2);return`${s}-${e}-${y} ${h}:${$}:${k}`};return L(()=>{p()}),(d,o)=>(c(),i(B,null,[t("div",Ft,[Ut,t("table",Vt,[Pt,t("tbody",null,[(c(!0),i(B,null,Y(M.value,s=>(c(),i("tr",{key:s.id},[t("td",null,n(s.id),1),t("td",null,n(_(s.create_at)),1),t("td",null,n(s.user.name),1),t("td",null,n(s.is_paid),1),t("td",null,[t("button",{type:"button",class:"btn btn-primary",onClick:e=>g("detail",s)},"詳細資訊",8,qt)]),t("td",null,[t("button",{type:"button",class:"btn btn-warning",onClick:e=>g("delete",s)},"刪除訂單",8,Ht)])]))),128))])])]),R(wt,{propitem:m.value,ref_key:"orderModalRef",ref:l,onClose:f},null,8,["propitem"]),R(Nt,{propitem:m.value,onClose:f,ref_key:"delOrderModal",ref:u},null,8,["propitem"])],64))}};export{jt as default};
