import{a as O}from"./axios-G2rPRu76.js";import{_ as H,e as h,p as T,k as E,o as d,c,a as t,d as I,t as n,g as W,m as Y,F as B,h as R,q as j,s as G,b as J}from"./index-MRf7kW_e.js";import{M as z}from"./modal-8GjLtis6.js";const r=b=>(j("data-v-2df43c9c"),b=b(),G(),b),K={id:"orderDetailModal",ref:"orderDetailModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderDetailModalLabel","aria-hidden":"true"},Q={class:"modal-dialog modal-xl"},X={class:"modal-content border-0"},Z=r(()=>t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"orderDetailModalLabel",class:"modal-title"},[t("span",null,"訂單資訊")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),tt={class:"modal-body"},et={class:"row"},st={class:"col-md-12"},lt={class:"table table-bordered"},ot={class:"t-title",colspan:"4"},at=r(()=>t("td",{class:"t-title"},"訂單編號",-1)),nt=r(()=>t("td",{class:"t-title"},"訂單時間",-1)),dt=r(()=>t("td",{class:"t-title"},"總價格",-1)),ct=r(()=>t("td",{class:"t-title"},"付款狀態",-1)),it={key:0},rt={key:1},ut={key:0,type:"button",class:"btn btn-success btn-sm"},pt={key:1,type:"button",class:"btn btn-secondary btn-sm"},_t=r(()=>t("td",{class:"t-title"},"用戶",-1)),ht=r(()=>t("td",{class:"t-title"},"電話號碼",-1)),bt=r(()=>t("td",{class:"t-title"},"地址",-1)),vt=r(()=>t("td",{class:"t-title"},"email",-1)),mt={class:"row"},yt=r(()=>t("div",{class:"col-md-12"},[t("span",null,"商品明細")],-1)),ft={class:"col-md-12"},$t={class:"table"},gt=r(()=>t("thead",null,[t("tr",null,[t("th",null,"商品名稱"),t("th",null,"數量"),t("th",null,"價格")])],-1)),Mt={class:"modal-footer"},kt={__name:"OrderDetail",props:{propitem:null},emits:["close"],setup(b,{expose:$,emit:k}){const g="https://ec-course-api.hexschool.io/v2",x="yangapi",w=b,v=k,u=h(null),o=T(()=>w.propitem),p=h(!1),m=h(!1),y=()=>{u.value.show()},_=()=>{u.value.hide(),m.value&&v("close")},f=async()=>{const l=`${g}/api/${x}/admin/order/${o.value.id}`;let e=!1;const s={data:o.value};return await O.put(l,s).then(i=>{const{success:M}=i.data;e=M,m.value=!0,alert("訂單更新成功！"),p.value=!1}).catch(i=>{alert(JSON.stringify(i))}),e};return E(async()=>{u.value=new z(document.getElementById("orderDetailModal"),{keyboard:!1})}),$({openModal:y,hideModal:_}),(l,e)=>{var s,i,M,C,D,S,L,N,V,U,F,P;return d(),c("div",K,[t("div",Q,[t("div",X,[Z,t("div",tt,[t("div",et,[t("div",st,[t("table",lt,[t("thead",null,[t("tr",null,[t("th",ot,[I(" 訂單資訊 "),p.value?(d(),c("button",{key:1,type:"button",class:"btn btn-primary",style:{float:"right"},onClick:f}," 儲存 ")):(d(),c("button",{key:0,type:"button",class:"btn btn-primary",style:{float:"right"},onClick:e[0]||(e[0]=a=>p.value=!0)}," 編輯 "))])])]),t("tbody",null,[t("tr",null,[at,t("td",null,n((s=o.value)==null?void 0:s.id),1),nt,t("td",null,n((i=o.value)==null?void 0:i.create_at),1)]),t("tr",null,[dt,t("td",null,n((M=o.value)==null?void 0:M.total),1),ct,p.value?(d(),c("td",it,[W(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>o.value.is_paid=a)},null,512),[[Y,o.value.is_paid]]),I("已付款 ")])):(d(),c("td",rt,[o.value.is_paid?(d(),c("button",ut,"已付款")):(d(),c("button",pt,"未付款"))]))]),t("tr",null,[_t,t("td",null,n((D=(C=o.value)==null?void 0:C.user)==null?void 0:D.name),1),ht,t("td",null,n((L=(S=o.value)==null?void 0:S.user)==null?void 0:L.tel),1)]),t("tr",null,[bt,t("td",null,n((V=(N=o.value)==null?void 0:N.user)==null?void 0:V.address),1),vt,t("td",null,n((F=(U=o.value)==null?void 0:U.user)==null?void 0:F.email),1)])])])])]),t("div",mt,[yt,t("div",ft,[t("table",$t,[gt,t("tbody",null,[(d(!0),c(B,null,R((P=o.value)==null?void 0:P.products,a=>{var q,A;return d(),c("tr",{key:a.id},[t("td",null,n((q=a==null?void 0:a.product)==null?void 0:q.title),1),t("td",null,n(a==null?void 0:a.qty),1),t("td",null,n((A=a==null?void 0:a.product)==null?void 0:A.price),1)])}),128))])])])])]),t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=a=>_())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=a=>_())}," 確認 ")])])])],512)}}},xt=H(kt,[["__scopeId","data-v-2df43c9c"]]),wt={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ot={class:"modal-dialog"},Ct={class:"modal-content border-0"},Dt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delOrderModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),St={class:"modal-body"},It=t("strong",{class:"text-danger"},null,-1),Bt={class:"modal-footer"},Et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Lt={__name:"DeleteOrderModal",props:{propitem:null},emits:["close"],setup(b,{expose:$,emit:k}){const g="https://ec-course-api.hexschool.io/v2",x="yangapi",w=b,v=k,u=h(null),o=()=>{u.value.show()},p=()=>{u.value.hide()},m=async()=>{const y=w.propitem.id,_=`${g}/api/${x}/admin/order/${y}`;let f=!1;return await O.delete(_).then(l=>{const{success:e}=l.data;f=e,alert("已刪除訂單"),p(),v("close")}).catch(l=>{alert(JSON.stringify(l))}),f};return E(async()=>{u.value=new z(document.getElementById("delOrderModal"),{keyboard:!1})}),$({openModal:o,hideModal:p}),(y,_)=>(d(),c("div",wt,[t("div",Ot,[t("div",Ct,[Dt,t("div",St,[I(" 是否刪除 "),It,I(" 商品"+n(b.propitem.title)+"(刪除後將無法恢復)。 ",1)]),t("div",Bt,[Et,t("button",{type:"button",class:"btn btn-danger",onClick:_[0]||(_[0]=f=>m())}," 確認刪除 ")])])])],512))}},Nt={class:"container"},Vt=t("div",{class:"row"},[t("div",{class:"col-md-8"},[t("h2",{class:"w50"},"訂單維護列表")])],-1),Ut={class:"table table-hover mt-4"},Ft=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"成立時間"),t("th",null,"用戶"),t("th",null,"付款狀態"),t("th",null,"詳細資訊"),t("th",null,"刪除訂單")])],-1),Pt=["onClick"],qt=["onClick"],zt={__name:"OrderManagement",setup(b){const $="https://ec-course-api.hexschool.io/v2",k="yangapi",g=h([]),x=h({}),w=h(!1),v=h({}),u=h(null),o=h(null),p=async(l=1)=>{const e=`${$}/api/${k}/admin/orders?page=${l}`;await O.get(e).then(s=>{g.value=s.data.orders,x.value=s.data.pagination}).catch(s=>{console.log(s)})},m=(l,e)=>{l==="detail"?(v.value={...e},o.value.openModal()):l==="edit"?(v.value={...e},w.value=!0,o.value.openModal()):l==="delete"&&(v.value=e,u.value.openModal())},y=()=>{p()},_=l=>{const e=new Date(l),s=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),M=("0"+e.getDate()).slice(-2),C=("0"+e.getHours()).slice(-2),D=("0"+e.getMinutes()).slice(-2),S=("0"+e.getSeconds()).slice(-2);return`${s}-${i}-${M} ${C}:${D}:${S}`},f=async()=>{const l=`${$}/api/user/check`;let e=!1;return await O.post(l).then(s=>{const{success:i}=s.data;e=i}).catch(s=>{alert(s.message)}),e};return E(()=>{var e;const l=(e=document.cookie.split("; ").find(s=>s.startsWith("hextoken=")))==null?void 0:e.split("=")[1];O.defaults.headers.common.Authorization=l,console.log(l),f().then(s=>{s?p():(alert("請登入"),window.location="#/admin")})}),(l,e)=>(d(),c(B,null,[t("div",Nt,[Vt,t("table",Ut,[Ft,t("tbody",null,[(d(!0),c(B,null,R(g.value,s=>(d(),c("tr",{key:s.id},[t("td",null,n(s.id),1),t("td",null,n(_(s.create_at)),1),t("td",null,n(s.user.name),1),t("td",null,n(s.is_paid),1),t("td",null,[t("button",{type:"button",class:"btn btn-primary",onClick:i=>m("detail",s)},"詳細資訊",8,Pt)]),t("td",null,[t("button",{type:"button",class:"btn btn-warning",onClick:i=>m("delete",s)},"刪除訂單",8,qt)])]))),128))])])]),J(xt,{propitem:v.value,ref_key:"orderModalRef",ref:o,onClose:y},null,8,["propitem"]),J(Lt,{propitem:v.value,onClose:y,ref_key:"delOrderModal",ref:u},null,8,["propitem"])],64))}};export{zt as default};
