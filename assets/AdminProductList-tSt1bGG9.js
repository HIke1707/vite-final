import{o as n,c as i,a as t,n as F,f as A,F as V,h as L,t as d,d as N,i as I,g as p,j as D,e as b,k as O,l as J,v as y,m as z,b as B}from"./index-Q8s6HybN.js";import{a as C}from"./axios-G2rPRu76.js";import{M as S}from"./modal-8GjLtis6.js";const R={"aria-label":"Page navigation example"},T={class:"pagination"},W=t("span",{"aria-hidden":"true"},"«",-1),q=[W],G={key:0,class:"page-link"},H=["onClick"],K=t("span",{"aria-hidden":"true"},"»",-1),Q=[K],X={__name:"PaginationVue",props:{pages:Number,default:()=>1},emits:["emit-pages"],setup(a,{emit:g}){const $=g,c=m=>{$("emit-pages",m)};return(m,r)=>(n(),i("nav",R,[t("ul",T,[t("li",{class:F(["page-item",{disabled:a.pages.current_page===1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:r[0]||(r[0]=A(s=>c(a.pages.current_page-1),["prevent"]))},q)],2),(n(!0),i(V,null,L(a.pages.total_pages,(s,v)=>(n(),i("li",{key:v,class:F(["page-item",{active:s===a.pages.current_page}])},[s===a.pages.current_page?(n(),i("span",G,d(s),1)):(n(),i("a",{key:1,class:"page-link",href:"#",onClick:A(h=>c(s),["prevent"])},d(s),9,H))],2))),128)),t("li",{class:F(["page-item",{disabled:a.pages.current_page===a.pages.total_pages}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:r[1]||(r[1]=A(s=>c(a.pages.current_page+1),["prevent"]))},Q)],2)])]))}},Y={id:"detail"},Z=t("h2",null,"單一產品細節",-1),tt={class:"card mb-3"},et=["src"],st={class:"card-body"},ot={class:"card-title"},lt={class:"badge bg-primary ms-2"},at={class:"card-text"},nt={class:"card-text"},it={class:"d-flex"},dt={class:"card-text me-2"},ct={class:"card-text text-secondary"},rt=["src"],ut={class:"text-secondary"},pt={__name:"ProductDetail",props:{product:{type:Object,default:()=>{}},hasFocus:{type:Boolean,default:()=>!1}},setup(a){return(g,$)=>(n(),i("div",Y,[Z,a.hasFocus?(n(),i(V,{key:0},[t("div",tt,[t("img",{src:a.product.imageUrl,class:"card-img-top primary-image",alt:"主圖"},null,8,et),t("div",st,[t("h5",ot,[N(d(a.product.title)+" ",1),t("span",lt,d(a.product.category),1)]),t("p",at,"商品描述："+d(a.product.description),1),t("p",nt,"商品內容："+d(a.product.content),1),t("div",it,[t("p",dt,d(a.product.price),1),t("p",ct,[t("del",null,d(a.product.origin_price),1)]),N(" 元 / "+d(a.product.unit),1)])])]),(n(!0),i(V,null,L(a.product.imagesUrl,(c,m)=>(n(),i("img",{key:m,src:c,alt:"",class:"images m-2"},null,8,rt))),128))],64)):I("",!0),p(t("p",ut,"請選擇一個商品查看",512),[[D,!a.hasFocus]])]))}},mt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},ht={class:"modal-dialog"},_t={class:"modal-content border-0"},bt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),vt={class:"modal-body"},gt=t("strong",{class:"text-danger"},null,-1),ft={class:"modal-footer"},yt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),$t={__name:"DeleteProductModal",props:{propitem:null},emits:["close"],setup(a,{expose:g,emit:$}){const c="https://ec-course-api.hexschool.io/v2",m="yangapi",r=a,s=$,v=b(null),h=()=>{v.value.show()},M=()=>{v.value.hide()},k=async()=>{const w=r.propitem.id,x=`${c}/api/${m}/admin/product/${w}`;let f=!1;return await C.delete(x).then(U=>{const{success:P}=U.data;f=P,alert("已刪除商品"),M(),s("close")}).catch(U=>{alert(JSON.stringify(U))}),f};return O(async()=>{v.value=new S(document.getElementById("delProductModal"),{keyboard:!1})}),g({openModal:h,hideModal:M}),(w,x)=>(n(),i("div",mt,[t("div",ht,[t("div",_t,[bt,t("div",vt,[N(" 是否刪除 "),gt,N(" 商品"+d(a.propitem.title)+"(刪除後將無法恢復)。 ",1)]),t("div",ft,[yt,t("button",{type:"button",class:"btn btn-danger",onClick:x[0]||(x[0]=f=>k())}," 確認刪除 ")])])])],512))}},kt={id:"product-modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},wt={class:"modal-dialog modal-xl"},xt={class:"modal-content border-0"},Mt={class:"modal-header bg-dark text-white"},Ut={id:"productModalLabel",class:"modal-title"},Pt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ct={class:"modal-body"},Vt={class:"row"},Nt={class:"col-sm-4"},Bt={class:"mb-2"},Ft={class:"mb-3"},Lt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),At=["src"],Dt={key:0},Ot=["src"],St=["onUpdate:modelValue"],Et={key:1},jt={class:"col-sm-8"},It={class:"mb-3"},Jt=t("label",{for:"title",class:"form-label"},"標題",-1),zt={class:"row"},Rt={class:"mb-3 col-md-6"},Tt=t("label",{for:"category",class:"form-label"},"分類",-1),Wt={class:"mb-3 col-md-6"},qt=t("label",{for:"price",class:"form-label"},"單位",-1),Gt={class:"row"},Ht={class:"mb-3 col-md-6"},Kt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Qt={class:"mb-3 col-md-6"},Xt=t("label",{for:"price",class:"form-label"},"售價",-1),Yt=t("hr",null,null,-1),Zt={class:"mb-3"},te=t("label",{for:"description",class:"form-label"},"產品描述",-1),ee={class:"mb-3"},se=t("label",{for:"content",class:"form-label"},"說明內容",-1),oe={class:"mb-3"},le={class:"form-check"},ae=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ne={__name:"ProductModal",props:["isopen","isnew","propitem"],emits:["close"],setup(a,{expose:g,emit:$}){const c="https://ec-course-api.hexschool.io/v2",m="yangapi",r=a,s=b(r.propitem),v=$,h=b(null),M=()=>{h.value.show()},k=()=>{h.value.hide()},w=async()=>{const u=`${c}/api/${m}/admin/product`;let e=!1;const o={data:s.value};return await C.post(u,o).then(l=>{const{success:_}=l.data;e=_,console.log("addProduct",e)}).catch(l=>{alert(JSON.stringify(l))}),e},x=async()=>{const u=`${c}/api/${m}/admin/product/${s.value.id}`;let e=!1;const o={data:s.value};return await C.put(u,o).then(l=>{const{success:_}=l.data;e=_,console.log("update",e)}).catch(l=>{alert(JSON.stringify(l))}),e},f=async()=>{let u=!1;return u=r.isnew?await w():await x(),v("close"),k(),u},U=()=>{k()},P=()=>{s.value.imagesUrl=[],s.value.imagesUrl.push("")};return J(()=>r.propitem,u=>{s.value=u}),O(async()=>{h.value=new S(document.getElementById("product-modal"),{keyboard:!1})}),g({openModal:M,hideModal:k}),(u,e)=>(n(),i("div",kt,[t("div",wt,[t("div",xt,[t("div",Mt,[t("h5",Ut,[t("span",null,d(a.isnew?"新增產品":"編輯產品"),1)]),Pt]),t("div",Ct,[t("div",Vt,[t("div",Nt,[t("div",Bt,[t("div",Ft,[Lt,p(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=o=>s.value.imageUrl=o)},null,512),[[y,s.value.imageUrl]])]),t("img",{class:"img-fluid",src:s.value.imageUrl,alt:""},null,8,At)]),Array.isArray(s.value.imagesUrl)?(n(),i("div",Dt,[(n(!0),i(V,null,L(s.value.imagesUrl,(o,l)=>(n(),i("div",{key:l},[t("img",{class:"img-fluid",src:o,alt:""},null,8,Ot),p(t("input",{type:"text",class:"form-control","onUpdate:modelValue":_=>s.value.imagesUrl[l]=_},null,8,St),[[y,s.value.imagesUrl[l]]])]))),128)),t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=o=>s.value.imagesUrl.push(""))}," 新增圖片 ")]),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=o=>s.value.imagesUrl.pop())}," 刪除圖片 ")])])):(n(),i("div",Et,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:P}," 新增圖片 ")]))]),t("div",jt,[t("div",It,[Jt,p(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[3]||(e[3]=o=>s.value.title=o)},null,512),[[y,s.value.title]])]),t("div",zt,[t("div",Rt,[Tt,p(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.category=o)},null,512),[[y,s.value.category]])]),t("div",Wt,[qt,p(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[5]||(e[5]=o=>s.value.unit=o)},null,512),[[y,s.value.unit]])])]),t("div",Gt,[t("div",Ht,[Kt,p(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[6]||(e[6]=o=>s.value.origin_price=o)},null,512),[[y,s.value.origin_price,void 0,{number:!0}]])]),t("div",Qt,[Xt,p(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[7]||(e[7]=o=>s.value.price=o)},null,512),[[y,s.value.price,void 0,{number:!0}]])])]),Yt,t("div",Zt,[te,p(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[8]||(e[8]=o=>s.value.content=o)},`
                `,512),[[y,s.value.content]])]),t("div",ee,[se,p(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[9]||(e[9]=o=>s.value.description=o)},`
                `,512),[[y,s.value.description]])]),t("div",oe,[t("div",le,[p(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.is_enabled=o)},null,512),[[z,s.value.is_enabled]]),ae])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:U}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:f}," 確認 ")])])])]))}},ie={class:"container"},de={class:"row py-3"},ce={class:"col-md-6"},re={class:"row"},ue=t("div",{class:"col-md-6"},[t("h2",{class:"w50"},"產品列表")],-1),pe={class:"col-md-6"},me={class:"table table-hover mt-4"},he=t("thead",null,[t("tr",null,[t("th",{width:"150"},"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"140"}," 是否啟用 "),t("th",{width:"140"}," 查看細節 "),t("th",{width:"180"}," 動作 ")])],-1),_e={width:"150"},be={width:"120"},ve={width:"120"},ge={width:"140"},fe={class:"text-success"},ye={width:"140"},$e=["onClick"],ke={width:"200"},we=["onClick"],xe=["onClick"],Me={class:"col-md-6"},Ve={__name:"AdminProductList",setup(a){const g="https://ec-course-api.hexschool.io/v2",$="yangapi",c=b([]),m=b(null),r=b(!1),s=b(!1),v=b(!1),h=b({imagesUrl:[]}),M=b({}),k=b(null),w=b(null),x=e=>{m.value=e,r.value=!0},f=async(e=1)=>{const o=`${g}/api/${$}/admin/products?page=${e}`;await C.get(o).then(l=>{console.log(l);const _=l.data.products;c.value=Object.entries(_).map(([E,j])=>({id:E,...j})),M.value=l.data.pagination}).catch(l=>{console.log(l)})},U=async()=>{const e=`${g}/api/user/check`;let o=!1;return await C.post(e).then(l=>{const{success:_}=l.data;o=_}).catch(l=>{alert(l.message)}),o},P=()=>{s.value=!1,f()},u=(e,o)=>{e==="new"?(h.value={imagesUrl:[]},v.value=!0,w.value.openModal()):e==="edit"?(h.value={...o},v.value=!1,w.value.openModal()):e==="delete"&&(h.value={...o},k.value.openModal())};return O(()=>{var o;const e=(o=document.cookie.split("; ").find(l=>l.startsWith("hextoken=")))==null?void 0:o.split("=")[1];C.defaults.headers.common.Authorization=e,console.log(e),U().then(l=>{l?f():(alert("請登入"),window.location="#/login")})}),(e,o)=>(n(),i(V,null,[t("div",ie,[t("div",de,[t("div",ce,[t("div",re,[ue,t("div",pe,[t("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#product-modal",style:{float:"right"},onClick:o[0]||(o[0]=l=>u("new",null))},"新增項目")])]),t("table",me,[he,t("tbody",null,[(n(!0),i(V,null,L(c.value,l=>(n(),i("tr",{key:l.id,class:F([{"table-secondary":!l.is_enabled}])},[t("td",_e,d(l.title),1),t("td",be,d(l.origin_price),1),t("td",ve,d(l.price),1),t("td",ge,[p(t("span",fe,"啟用",512),[[D,l.is_enabled]]),p(t("span",null,"未啟用",512),[[D,!l.is_enabled]])]),t("td",ye,[t("button",{type:"button",class:"btn btn-primary",onClick:_=>x(l)},"查看細節",8,$e)]),t("td",ke,[t("button",{type:"button",class:"btn btn-primary",onClick:_=>u("delete",l)},"刪除",8,we),t("button",{type:"button",class:"btn btn-primary",onClick:_=>u("edit",l)},"編輯",8,xe)])],2))),128))])]),B(X,{pages:M.value,onEmitPages:f},null,8,["pages"]),t("p",null,[N("目前有 "),t("span",null,d(c.value.length),1),N(" 項產品")])]),t("div",Me,[B(pt,{product:m.value,"has-focus":r.value},null,8,["product","has-focus"])])])]),B(ne,{isnew:v.value,propitem:h.value,onClose:P,ref_key:"productModalRef",ref:w},null,8,["isnew","propitem"]),B($t,{propitem:h.value,onClose:P,ref_key:"delProductModal",ref:k},null,8,["propitem"])],64))}};export{Ve as default};
